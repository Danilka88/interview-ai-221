<!DOCTYPE html>
<html lang="ru" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–∏–∑ –û—Ç–±–æ—Ä–∞)</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
        body {
            padding-top: 5rem;
        }

        main.container {
            margin-top: 1rem;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .score-card {
            text-align: center;
            padding: 2rem;
            border-radius: var(--pico-border-radius);
            background-color: var(--pico-card-background-color);
        }

        .score {
            font-size: 4rem;
            font-weight: bold;
            line-height: 1;
        }

        .grid>article {
            margin-bottom: 21px;
        }

        .keywords-container kbd {
            background-color: var(--pico-secondary-background);
            color: var(--pico-secondary-color);
            padding: 0.25rem 0.5rem;
            border-radius: var(--pico-border-radius);
            margin: 0.25rem 0.25rem 0.25rem 0;
            display: inline-block;
        }

        details>summary {
            font-size: 1.25rem;
            font-weight: bold;
        }

        details {
            margin-bottom: 1.5rem;
        }
    </style>
</head>

<body>
    <nav class="container-fluid">
        <ul>
            <li>
                <details class="dropdown">
                    <summary role="button">–ú–µ–Ω—é</summary>
                    <ul>
                        <!-- –ì—Ä—É–ø–ø–∞ 1: –û—Å–Ω–æ–≤–Ω–æ–π –≤–æ—Ä–∫—Ñ–ª–æ—É -->
                        <li><a href="/dashboard">–î–∞—à–±–æ—Ä–¥</a></li>
                        <li><a href="/rank">–û—Ç–±–æ—Ä —Ä–µ–∑—é–º–µ</a></li>
                        <li><hr></li>
                        <!-- –ì—Ä—É–ø–ø–∞ 2: –û—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -->
                        <li><a href="/vacancy_builder">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤–∞–∫–∞–Ω—Å–∏–π</a></li>
                        <li><a href="/voice-interview">–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ</a></li>
                        <li><a href="/test">–¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–∏–º—É–ª—è—Ü–∏—è</a></li>
                        <li><hr></li>
                        <!-- –ì—Ä—É–ø–ø–∞ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø—Ä–æ—á–µ–µ -->
                        <li><a href="/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                        <li><a href="/audio-processing/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ</a></li>
                        <li><a href="/llm-providers/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤</a></li>
                        <li><a href="/result">–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç</a></li>
                        <li><a href="#" id="clear-storage-btn">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</a></li>
                    </ul>
                </details>
            </li>
        </ul>
        <ul>
            <li><strong>VTB AI</strong></li>
        </ul>
    </nav>

    <main class="container">
        <!-- –≠–∫—Ä–∞–Ω 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ -->
        <div id="loading-container">
            <h2 style="text-align: center;">–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
            <article aria-busy="true">–ò–¥–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑, —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ –º–∏–Ω—É—Ç—ã...</article>
        </div>

        <!-- –≠–∫—Ä–∞–Ω 2: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div id="results-container" style="display: none;">
            <header>
                <hgroup>
                    <h2>–û—Ç—á–µ—Ç –ø–æ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é</h2>
                    <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –∞–Ω–∞–ª–∏–∑, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.</p>
                </hgroup>
            </header>

            <!-- –ê–Ω–∞–ª–∏–∑ –Ω–∞ –±—É–º–∞–≥–µ -->
            <details open>
                <summary>üìÑ –ê–Ω–∞–ª–∏–∑ –Ω–∞ –±—É–º–∞–≥–µ (–í–∞–∫–∞–Ω—Å–∏—è vs. –†–µ–∑—é–º–µ)</summary>
                <article>
                    <p id="on-paper-summary">-</p>
                    <div class="grid">
                        <div>
                            <strong>–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:</strong>
                            <ul id="on-paper-strengths"></ul>
                        </div>
                        <div>
                            <strong>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏:</strong>
                            <ul id="on-paper-gaps"></ul>
                        </div>
                    </div>
                </article>
            </details>

            <!-- –ê–Ω–∞–ª–∏–∑ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è -->
            <details open>
                <summary>üéôÔ∏è –ê–Ω–∞–ª–∏–∑ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è (–í–∞–∫–∞–Ω—Å–∏—è vs. –î–∏–∞–ª–æ–≥)</summary>
                <div class="grid">
                    <article class="score-card">
                        <h3 style="margin-bottom: 0.5rem;">–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞</h3>
                        <p id="score" class="score">-</p>
                        <p>/ 100</p>
                    </article>
                    <article>
                        <h4>–û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ—Ç –¥–∏–∞–ª–æ–≥–∞</h4>
                        <p id="interview-summary">-</p>
                    </article>
                </div>
                <div class="grid">
                    <article>
                        <h4>‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã</h4>
                        <p id="positive-summary">-</p>
                        <div id="positive-keywords" class="keywords-container"></div>
                    </article>
                    <article>
                        <h4>‚ö†Ô∏è –°–ø–æ—Ä–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã</h4>
                        <p id="negative-summary">-</p>
                        <div id="negative-keywords" class="keywords-container"></div>
                    </article>
                </div>
                <article>
                    <h4>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω –±–µ—Å–µ–¥—ã</h4>
                    <p id="emotion-summary">-</p>
                    <div id="emotion-keywords" class="keywords-container"></div>
                </article>
            </details>

            <!-- –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
            <details open>
                <summary>‚≠ê –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</summary>
                <div class="grid">
                    <article>
                        <h4>üìù –î–ª—è –Ω–∞–Ω–∏–º–∞—é—â–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h4>
                        <p id="manager-notes-summary">-</p>
                        <div id="manager-notes-keywords" class="keywords-container"></div>
                    </article>
                    <article>
                        <h4>üìà –î–ª—è —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è</h4>
                        <p id="candidate-feedback-summary">-</p>
                        <div id="candidate-feedback-keywords" class="keywords-container"></div>
                    </article>
                </div>
            </details>

            <button id="download-log-btn">–°–∫–∞—á–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –ª–æ–≥ –¥–∏–∞–ª–æ–≥–∞ (JSON)</button>
        </div>
    </main>

    <script>
        const loadingContainer = document.getElementById('loading-container');
        const resultsContainer = document.getElementById('results-container');
        const downloadLogBtn = document.getElementById('download-log-btn');

        let analysisData = {};

        function renderKeywords(element, items) {
            element.innerHTML = '';
            if (items && items.length > 0) {
                items.forEach(text => {
                    const kbd = document.createElement('kbd');
                    kbd.textContent = text;
                    element.appendChild(kbd);
                });
            } else {
                element.innerHTML = '<small>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</small>';
            }
        }

        function renderList(element, items) {
            element.innerHTML = '';
            if (items && items.length > 0) {
                items.forEach(text => {
                    const li = document.createElement('li');
                    li.textContent = text;
                    element.appendChild(li);
                });
            } else {
                element.innerHTML = '<li>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</li>';
            }
        }

        function renderAnalysisBlock(dataBlock, summaryEl, keywordsEl) {
            if (dataBlock) {
                summaryEl.textContent = dataBlock.summary || '-';
                renderKeywords(keywordsEl, dataBlock.keywords);
            } else {
                summaryEl.textContent = '–ê–Ω–∞–ª–∏–∑ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª—Å—è.';
                if (keywordsEl) keywordsEl.innerHTML = '';
            }
        }

        function renderResults(data) {
            const onPaper = data.on_paper_analysis;
            if (onPaper) {
                document.getElementById('on-paper-summary').textContent = onPaper.summary || '-';
                renderList(document.getElementById('on-paper-strengths'), onPaper.strengths);
                renderList(document.getElementById('on-paper-gaps'), onPaper.gaps);
            }

            const interview = data.interview_analysis;
            if (interview) {
                document.getElementById('score').textContent = interview.suitability_score || '-';
                document.getElementById('interview-summary').textContent = interview.overall_summary || '-';
                renderAnalysisBlock(interview.positive_points, document.getElementById('positive-summary'), document.getElementById('positive-keywords'));
                renderAnalysisBlock(interview.negative_points, document.getElementById('negative-summary'), document.getElementById('negative-keywords'));
                renderAnalysisBlock(interview.emotional_tone, document.getElementById('emotion-summary'), document.getElementById('emotion-keywords'));
            }

            const recommendations = data.final_recommendations;
            if (recommendations) {
                renderAnalysisBlock(recommendations.manager_notes, document.getElementById('manager-notes-summary'), document.getElementById('manager-notes-keywords'));
                renderAnalysisBlock(recommendations.candidate_feedback, document.getElementById('candidate-feedback-summary'), document.getElementById('candidate-feedback-keywords'));
            }

            loadingContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
        }

        async function analyzeInterview(data) {
            try {
                const response = await fetch('/analyze-interview', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.detail?.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ');
                }
                const analysisResult = await response.json();
                renderResults(analysisResult);
            } catch (error) {
                loadingContainer.innerHTML = `<article><strong>–û—à–∏–±–∫–∞!</strong><br>${error.message}</article>`;
            }
        }

        window.addEventListener('load', () => {
            const storedData = localStorage.getItem('interviewAnalysisData');
            if (storedData) {
                analysisData = JSON.parse(storedData);
                analyzeInterview(analysisData);
            } else {
                loadingContainer.innerHTML = '<article>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ.</article>';
            }
        });

        downloadLogBtn.addEventListener('click', () => {
            if (!analysisData.conversation_history) return;
            const jsonData = JSON.stringify(analysisData.conversation_history, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'interview_dialogue.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        document.getElementById('clear-storage-btn').addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')) {
                localStorage.clear();
                alert('–ö—ç—à –æ—á–∏—â–µ–Ω. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞.');
                window.location.href = '/';
            }
        });

    </script>
</body>

</html>